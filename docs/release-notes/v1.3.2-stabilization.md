# v1.3.2 Stabilization Release Notes

This release focuses on codebase stabilization, improved debugging capabilities, and better configuration validation.

## Highlights

- **Empty catch block remediation**: 23+ empty catch blocks replaced with proper debug logging
- **Timeout validation**: User-configurable timeouts now validated between 5-600 seconds
- **Constants centralization**: Key configuration values moved to `BrainarrConstants` for maintainability
- **Music styles integration**: Full style catalog integration with normalization and filtering

## Breaking Changes

None. This is a backwards-compatible stabilization release.

## Improvements

### Error Handling & Debugging

Empty catch blocks that previously swallowed exceptions silently now log at debug level:

- `BrainarrOrchestrator.cs`: 12 fixes for iteration profiles, metrics, rate limiting, token estimates
- `RecommendationPipeline.cs`: 8 fixes for run headers, validation summaries, deduplication, top-up logging
- `SafetyGateService.cs`: 3 fixes for borderline item preview and history marking
- `TopUpPlanner.cs`: 3 fixes for planner state and summary logging

Enable debug logging in Lidarr settings to see these previously hidden exceptions.

### Configuration Validation

New timeout bounds validation ensures user-configured values stay within safe ranges:

| Setting | Min | Default | Max |
| --- | --- | --- | --- |
| AI Request Timeout | 5s | 30s | 600s |
| Local Provider Default | - | 360s | - |

Local providers (Ollama/LM Studio) automatically elevate to 360s timeout when using the default 30s setting.

### Constants Centralization

New centralized constants in `BrainarrConstants`:

**Timeout Settings**
- `MinAITimeout` = 5 seconds
- `MaxAITimeout` = 600 seconds (10 minutes)
- `LocalProviderDefaultTimeout` = 360 seconds (6 minutes)

**Circuit Breaker**
- `CircuitBreakerSamplingWindow` = 20 requests
- `CircuitBreakerMinimumThroughput` = 10 requests
- `CircuitBreakerFailureThreshold` = 50%
- `CircuitBreakerDurationSeconds` = 30 seconds

**Token Limits**
- `DefaultMaxTokens` = 2000
- `CloudProviderMaxTokens` = 1500
- `LocalProviderMaxTokens` = 4096

**Input Validation**
- `MaxGenreNameLength` = 100
- `MaxPromptLength` = 5000
- `MaxMemoryCacheEntries` = 1000
- `RegexTimeoutMs` = 100

### Test Coverage

New and enhanced test coverage:

- `SafetyGateServiceTests.cs`: Comprehensive tests for safety gate filtering (422 lines)
- `CircuitBreakerTests.cs`: Extended tests for state transitions and thread safety (+358 lines)
- `RecommendationPipelineTests.cs`: Style filtering tests (+390 lines)

## Migration Guide

No migration steps required. Simply update to the new version.

## Known Issues

None identified.

## Contributors

- Claude (AI Assistant)
